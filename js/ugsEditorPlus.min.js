/**
 * This library implments the UkeGeeks Scriptasaurus Song-a-matic editor functions, bridging the page UI and scriptasaurus methods.
 * @module  ugsEditorPlus
 * @namespace  ugsEditorPlus
 * @class ugsEditorPlus
 */
var ugsEditorPlus = (function() {
	/**
	 * attach public members to this object
	 * @property _public
	 * @type JsonObject
	 */
	var _public = {};

	/**
	 * attaches event handlers, preps variables, and runs UGS
	 * @method init
	 * @private
	 * @param isLegacyIe {bool} pre-IE 9 versions
	 */
	var init = function(isLegacyIe) {
		// ukeGeeks.tumblr.opts.diagramResizeTo = 1;
		ukeGeeks.settings.opts.retainBrackets = false;

		ukeGeeks.scriptasaurus.init(isLegacyIe);

		ugsEditorPlus.actions.init(isLegacyIe);
		ugsEditorPlus.topMenus.init();
		ugsEditorPlus.submenuUi.init();
		ugsEditorPlus.optionsDlg.init();
		ugsEditorPlus.chordBuilder.init();
		ugsEditorPlus.actions.run();
	};

	/**
	 * wraps the private Init method for modern browsers
	 * @method attach
	 * @public
	 */
	_public.attach = function() {
		init(false);
	};

	/**
	 * wraps the private Init method, required for Legacy Internet Exploere (pre-9)
	 * @method attach
	 * @public
	 */
	_public.attachIe = function() {
		init(true);
	};

	// ---------------------------------------
	// return public interface "JSON handle"
	// ---------------------------------------
	return _public;

}());
;ugsEditorPlus.actions=function(){var a={},b={},c=null,h=null,k=[],d=/^([A-G][#b]?)(m|m6|7|m7|dim|maj7|6|sus2|sus4|aug|9)?$/,m={placement:"above",transpose:"up_0"};a.init=function(c){b={songText:document.getElementById("ukeSongText"),songContainer:document.getElementById("ukeSongContainer"),cpmSource:document.getElementById("chordProSource"),scalableArea:document.getElementById("scalablePrintArea")};$(document).on("option:click",function(c,t){var g=t.action,f=t.value;switch(g){case "zoomFonts":f=parseFloat(f,
10);b.scalableArea.style.fontSize=f+"pt";break;case "zoomDiagrams":var f=parseInt(f,10)/100,g=Math.round(225*f),l=ugsEditorPlus.styles.getSheet("ugsEditorCss"),e=l.find(".scalablePrintArea .ugs-diagrams-wrap canvas");e.style.width=Math.round(f*ukeGeeks.settings.fretBox.width)+"px";e.style.height=Math.round(f*ukeGeeks.settings.fretBox.height)+"px";e=l.find(".scalablePrintArea .ugs-diagrams-wrap");e.style.width=g+"px";e=l.find(".scalablePrintArea .ugs-source-wrap");e.style.marginLeft=25+g+"px";break;
case "layout":$("body").toggleClass("diagramsOnTop","top"==f).toggleClass("diagramsOnSide","left"==f).toggleClass("ugsHideDiagrams","none"==f);break;case "placement":ukeGeeks.toolsLite.setClass(b.songContainer,"ugsInline","inline"==f);(g="miniDiagrams"==f)||ukeGeeks.toolsLite.removeClass(b.songContainer,"ugsInlineDiagrams");g||"miniDiagrams"==m.placement?(ukeGeeks.settings.inlineDiagrams=g,a.run()):g||"miniDiagrams"==m.placement||ukeGeeks.overlapFixer.Fix(b.songText);m.placement=f;break;case "tuning":g=
ukeGeeks.definitions.instrument.sopranoUke;l="Standard <strong>GCEA</strong> Soprano Ukulele";"baritone"==f&&(g=ukeGeeks.definitions.instrument.baritoneUke,l="Standard <strong>DGBE</strong> Baritone Ukulele");$("#footTuningInfo").html(l);ukeGeeks.scriptasaurus.setTuningOffset(g);a.run();break;case "colors":ugsEditorPlus.themes.set(f);a.run();break;case "transpose":g="u"==f[0]?1:-1;f=parseInt(f[f.length-1],10);var f=g*f,e=[],g="",p;for(p=0;p<k.length;p++)d.test(k[p])?e.push(k[p]):g+=k[p]+", ";if(!(0<
g.length)||confirm("Sorry, but some of your chords can't be transposed:\n"+g+"\n\nDo you want to continue anyway?")){var n=ukeGeeks.transpose.shiftChords(e,f),g=h;for(p=0;p<e.length;p++)l=RegExp("\\["+e[p]+"\\]","g"),g=g.replace(l,"[ugsxx_"+p+"]");for(p=0;p<n.length;p++)l=RegExp("\\[ugsxx_"+p+"\\]","g"),g=g.replace(l,"["+n[p]+"]");l=/^\s*\{\s*(key|k)\s*:\s*(\S*?)\s*\}\s*$/im;l.test(g)&&(e=g.match(l),p=e[2],""!==p&&d.test(p)&&(g=g.replace(l,e[0].replace(p,ukeGeeks.transpose.shift(p,f)))));b.cpmSource.value=
g;a.run()}break;case "paper":g=["letter","a4","screen"];l=$("body");for(e=0;e<g.length;e++)l.removeClass("pageWidth_"+g[e]);l.addClass("pageWidth_"+f);break;case "showEnclosures":ukeGeeks.settings.opts.retainBrackets=f;a.run();break;case "hideCommonChords":ukeGeeks.settings.opts.ignoreCommonChords=f;a.run();break;case "setCommonChords":f=f.split(/[ ,]+/);g=[];for(l=0;l<f.length;l++)e=ukeGeeks.toolsLite.trim(f[l]),0<e.length&&g.push(e);ukeGeeks.settings.commonChords=g;ukeGeeks.settings.opts.ignoreCommonChords&&
a.run();break;case "update":a.run(!0);break;default:console.log("Unrecognized "+g+" > "+f)}})};a.run=function(d){d=0<arguments.length&&d;b.songText.innerHTML="<pre>"+b.cpmSource.value+"</pre>";c=ukeGeeks.scriptasaurus.run();1>c.chords.length&&ugsEditorPlus.autoReformat.run(b);if(c&&(ugsEditorPlus.songUi.update(c),d||null===h)){h=b.cpmSource.value;k=c.chords;var a=""!==c.key?c.key:1>c.chords.length?"":c.chords[0],t=document.getElementById("transposeOptions").getElementsByTagName("li"),g,f=-6;m.transpose=
"up_0";ugsEditorPlus.submenuUi.resetTransposeLabel();for(var l=0;l<t.length;l++)ukeGeeks.toolsLite.removeClass(t[l],"checked"),g=1>a.length?"":ukeGeeks.transpose.shift(a,f),t[l].getElementsByTagName("em")[0].innerHTML=g,0===f&&ukeGeeks.toolsLite.addClass(t[l],"checked"),f++}};return a}();
ugsEditorPlus.songUi=function(){var a={},b=function(c,b){var a=b&&0<b.length,d=document.getElementById(c);d&&(d.innerHTML=a?b:"",d.style.display=a?"block":"none")};a.update=function(c){var h=document.getElementById("songTitle");h.innerHTML=0<c.title.length?c.title:"Untitled-Song";b("songArtist",c.artist);b("songAlbum",c.album);b("songSubtitle",c.st);h=document.getElementById("songMeta");if(!c.ugsMeta||1>c.ugsMeta.length)h.style.display="none";else{for(var a="",d=0;d<c.ugsMeta.length;d++)a+="<p>"+
c.ugsMeta[d]+"</p>";h.innerHTML=a;h.style.display="block"}};return a}();
ugsEditorPlus.styles=function(){var a={Rules:null},b=null;a.getSheet=function(c){a:{for(var h=0;h<document.styleSheets.length;h++)if(document.styleSheets[h].title==c){b=document.styleSheets[h];break a}b=null}c=null==b?[]:b.cssRules?b.cssRules:b.rules;a.Rules=c;return this};a.find=function(c){c=c.toLowerCase();for(var b=0;b<a.Rules.length;b++)if(a.Rules[b].selectorText&&a.Rules[b].selectorText.toLowerCase()==c)return a.Rules[b];return null};return a}();
ugsEditorPlus.themes=function(){var a={},b={normal:{name:"Normal (white paper)",selectText:"Normal colors (white paper)",description:"Simple, legible text on white paper",song:{fretLines:"#003366",dots:"#ff0000",dotText:"#ffffff",text:"#000000",fretText:"#4a4a4a"},tabs:{lines:"#999999",dots:"#eaeaea",text:"#000000"}},reversed:{name:"Reversed for projectors",selectText:"Reversed colors (for projectors)",description:"Light text on dark background",song:{fretLines:"#365F70",dots:"#FDD96F",dotText:"#000000",
text:"#FF6040",fretText:"#999999"},tabs:{lines:"#365F70",dots:"#FDD96F",text:"#000000"}},frosty:{name:"Frostcicle",selectText:"Frostcicle (cool blue)",description:"Brrrr... icy cool blues",song:{fretLines:"#66B4CC",dots:"#332335",dotText:"#9FE1F9",text:"#0896FE",fretText:"#E3D8BA"},tabs:{lines:"#6699FF",dots:"#EFFCF9",text:"#00558E"}},jellyBean:{name:"Jelly Beans",selectText:"Jelly Beans (vibrant)",description:"Sugary, vibrant bowl of jelly beans!",song:{fretLines:"#49BC45",dots:"#FF9417",dotText:"#FCF49F",
text:"#D20070",fretText:"#4a4a4a"},tabs:{lines:"#6699FF",dots:"#FFF9BA",text:"#75003E"}},justBlack:{name:"Just Black",selectText:"Black (for laser printers)",description:"No color, but black, best for B&W laser printers",song:{fretLines:"#cccccc",dots:"#000000",dotText:"#ffffff",text:"#000000",fretText:"#000000"},tabs:{lines:"#cccccc",dots:"#000000",text:"#ffffff"}},krampus:{name:"Gruss vom Krampus",selectText:"Krampus (Ye Olde Christmas)",description:"Seasons Greetin's, Happy Holidays, Merry Christmas, Krampus Nichte!",
song:{fretLines:"#929867",dots:"#A22C27",dotText:"#EBD592",text:"#4F2621",fretText:"#4a4a4a"},tabs:{lines:"#B69C01",dots:"#E1EEC8",text:"#75003E"}},western:{name:"Out West",selectText:"Out West (dust country)",description:"Dusty Honky Tonk/Country/Western look",song:{fretLines:"#B5A679",dots:"#CF8300",dotText:"#ffffff",text:"#386571",fretText:"#4a4a4a"},tabs:{lines:"#697665",dots:"#F1E3C5",text:"#632424"}},pumpkin:{name:"Pumpkin Pie",selectText:"Pumpkin Pie (fall colors)",description:"Fall 'n Halloween 'n Jack o'Lantern 'n Thanksgiving Fun",
song:{fretLines:"#8E9A6C",dots:"#DA6328",dotText:"#FFEE4A",text:"#68391D",fretText:"#B14623"},tabs:{lines:"#BED379",dots:"#FFF4D8",text:"#B14623"}},notebook:{name:"Rock Notebook",selectText:"Rock Notebook (marker)",description:"A strong, hand-scrawled, and edgily unreliable look",song:{fretLines:"#747CAD",dots:"#1C0866",dotText:"#ffffff",text:"#B22000",fretText:"#A4A0B2"},tabs:{lines:"#A4A0B2",dots:"#F1E3C5",text:"#2E2ECC"}},zombie:{name:"Zombies!!!",selectText:"Zombies!!!",description:"Blood 'n gore for Halloween",
song:{fretLines:"#9EB036",dots:"#E52501",dotText:"#FEDA79",text:"#798666",fretText:"#B14623"},tabs:{lines:"#602749",dots:"#F7F9EA",text:"#4F5F3E"}}};a.getDescription=function(c){return b[c].selectText};a.loadList=function(c){var a="",k;for(k in b)b.hasOwnProperty(k)&&(a+='<li class="'+("normal"==k?"checked":"")+'"><a href="#'+k+'" title="'+b[k].description+'">'+b[k].name+"</a></li>");$(c).html(a)};a.set=function(c){var a=$("body"),k;for(k in b)b.hasOwnProperty(k)&&a.removeClass("theme-"+k);a.addClass("theme-"+
c);c=b[c];ukeGeeks.settings.colors=c.song;ukeGeeks.settings.tabs.lineColor=c.tabs.lines;ukeGeeks.settings.tabs.dotColor=c.tabs.dots;ukeGeeks.settings.tabs.textColor=c.tabs.text};return a}();
ugsEditorPlus.optionsDlg=function(){var a={},b,c,h;a.init=function(){b=document.getElementById("commonChordList");c=document.getElementById("chkIgnoreCommon");h=document.getElementById("chkEnclosures");b.value=ukeGeeks.settings.commonChords.join(", ");c.checked=ukeGeeks.settings.opts.ignoreCommonChords;h.checked=!ukeGeeks.settings.opts.retainBrackets;document.getElementById("updateBtn").onclick=function(){k("update","");return!1};h.onclick=function(){k("showEnclosures",!this.checked)};b.onchange=
function(){k("setCommonChords",b.value)};c.onclick=function(){k("hideCommonChords",this.checked)};$(".checkboxBlock label, input[type=checkbox]").click(function(b){b.stopPropagation()});$(".overlay").draggable({handle:"hgroup"})};var k=function(b,c){$.event.trigger("option:click",{action:b,value:c})};return a}();var ugsEditorPlus=window.ugsEditorPlus||{};
ugsEditorPlus.reformat=function(){var a={},b=!1,c=function(){this.source="";this.spaceCount=this.wordCount=0;this.words=[];this.lineType=this.chordCount=0},h=/\b(\S+)\b/gi,k=/(\s+)/g,d=/(^\s+)/,m=/\b[A-G][#b]?(m|m6|m7|m9|dim|dim7|maj7|sus2|sus4|aug|6|7|9|add9|7sus4)?\b/,n=/\b(\S+\s*)/g,r=/^\s*(\|{0,2}[A-Gb]?\|{0,2}[-x0-9|:]{4,})/;a.run=function(a){b=!1;var g=[];a=a.replace("\t","    ");a=a.split("\n");for(var f=0;f<a.length;f++){var l=a[f].match(h),e=new c;e.source=a[f];if(null!=l&&0<l.length){e.wordCount=
l.length;e.words=l;for(var p=e,q=0,s=0;s<l.length;s++)l[s].match(m)&&q++;p.chordCount=q}p=a[f].match(k);null!=p&&0<p.length&&(e.spaceCount=p.length);p=e;l=e;1>l.spaceCount+l.wordCount?l=0:null!=l.source.match(r)?l=3:(q=2,0<l.chordCount&&l.wordCount==l.chordCount&&(q=1,b=!0),l=q);p.lineType=l;g.push(e)}f="";for(a=0;a<g.length;)if(e=g[a],p=g[a+1],a++,p&&0!=e.lineType){if(l=3==e.lineType)a:if(a+3>=g.length)l=!1;else{for(l=a;l<a+3;l++)if(3!=g[l].lineType){l=!1;break a}l=!0}if(l)f+="{start_of_tab}\n"+
e.source.replace(d,"")+"\n"+p.source.replace(d,"")+"\n"+g[a+1].source.replace(d,"")+"\n"+g[a+2].source.replace(d,"")+"\n{end_of_tab}\n",a+=3;else if(1!=e.lineType||2!=p.lineType){if(1==e.lineType){e=e.source.replace(k," ").split(" ");p="";for(l=0;l<e.length;l++)0<e[l].length&&(p+="["+e[l]+"] ");e=p+"\n"}else e=e.source+"\n";f+=e}else{a++;q=e.source;for(e=p.source;e.length<q.length;)e+=" ";p="";l=q.match(n);s=q.match(d);q=0;s&&(p+=e.substr(q,s[0].length),q=s[0].length);for(s=0;s<l.length;s++)p+="["+
l[s].replace(k,"")+"]"+e.substr(q,l[s].length),q+=l[s].length;q<e.length&&(p+=e.substr(q,e.length));f+=p+"\n"}}else f+=e.source+"\n";return f};a.hasChords=function(){return b};return a}();
ugsEditorPlus.autoReformat=function(){var a={},b={},c,h=!1;a.run=function(a){h||(b=a,b.reformatTextBox=document.getElementById("reformatSource"),b.reformatDlg=document.getElementById("reformatDlg"),document.getElementById("reformatYesBtn").onclick=function(){b.cpmSource.value=c;k();ugsEditorPlus.actions.run(!0);return!1},document.getElementById("reformatNoBtn").onclick=function(){k();return!1},a=document.getElementById("reformatDisable"),a.checked=!1,a.onclick=function(){h=this.checked},c=ugsEditorPlus.reformat.run(b.cpmSource.value),
b.reformatTextBox.innerHTML=c,ugsEditorPlus.reformat.hasChords()&&ukeGeeks.toolsLite.removeClass(b.reformatDlg,"isHidden"))};var k=function(){ukeGeeks.toolsLite.addClass(b.reformatDlg,"isHidden")};return a}();
ugsEditorPlus.topMenus=function(){var a=function(){var a=$(this).parent(),c=a.hasClass("active");b();c||a.addClass("active")},b=function(){$("#ugsAppToolbar > ul > li").removeClass("active")},c=function(){b();$(".arrowBox").hide()},h=function(a){c();a=$(this).data("dialog");$("#"+a).fadeIn();return!1},k=function(a){$(this).parents(".overlay").fadeOut();return!1},d=function(a){c();a=$(this).parents(".overlay");ugsEditorPlus.resize.toggle(a);return!1},m=function(a){a=$(this).attr("href");$(".arrowBox").not(a).hide();
a=$(a);a.find("dd").hide();a.fadeToggle();ugsEditorPlus.submenuUi.reset(a);return!1};return{init:function(){$("#ugsAppToolbar > ul li").not("[data-dialog]").children("a").click(a);$(".showOptionsBox a").click(m);$("#ugsAppToolbar > ul li[data-dialog]").click(h);$(".closeBtn").click(k);$(".resizeBtn").click(d)},makeAllInactive:b}}();
ugsEditorPlus.submenuUi=function(){var a={},b=null;a.init=function(){ugsEditorPlus.themes.loadList("#colorPicker .pseudoSelect");$(".enablePseudoSelects label").click(h);$(".pseudoSelect li").click(c);$("body").bind("click",m);$(".arrowBox").click(d)};var c=function(a){a=$(this);var g;g=a.children().attr("href");g="#"==g[0]?g.substr(1):g;var c=a.parents("dd"),l=c.attr("id"),c=c.data("action");$("#"+l).hide().find("li").removeClass("checked");a.addClass("checked");k(this,!1);b=null;$("label[for="+
l+"] span").text(r(c,g,a));$("label[for="+l+"]").parents("dt").removeClass("active");$.event.trigger("option:click",{action:c,value:g});return!1},h=function(a){a=$(this);var g=a.attr("for");a.closest("dl").children("dt").removeClass("active");a.closest("dt").addClass("active");$("#"+g).show();k(this,!0);null!=b&&$("#"+b.id).hide();b=null!=b&&b.id==g?null:{id:g};return!1};a.reset=function(a){a.find("dt").removeClass("active");a.find(".event-userSelecting").removeClass("event-userSelecting")};var k=
function(a,g){$(a).parents(".enablePseudoSelects").toggleClass("event-userSelecting",g)},d=function(a){if(!$(a.target).is("a"))return $(this).find("dd").hide(),b=null,!1},m=function(a){$(".arrowBox").fadeOut(270);ugsEditorPlus.topMenus.makeAllInactive()},n={zoomDiagrams:["Tiny","Small","Medium","Large","Stupid Large"],layout:["Reference diagrams on left","Reference diagrams at top","No reference diagrams"],placement:["Chord names inline with lyrics","Chord names above lyrics","Names & diagrams above lyrics"],
tuning:["Soprano (GCEA) tuning","Baritone (DBEA) tuning"]},r=function(a,g,c){var b=c.index();switch(a){case "paper":return"Width "+c.text();case "zoomFonts":return"Font size "+g+"pt";case "zoomDiagrams":return n.zoomDiagrams[b]+" diagrams";case "colors":return ugsEditorPlus.themes.getDescription(g);case "transpose":return"up_0"==g?"Original key":c.text().replace(" ",' steps - "')+'"';default:return n[a][b]}};a.resetTransposeLabel=function(){$("label[for=transposePicker] span").text("Original key")};
return a}();
ugsEditorPlus.newSong=function(){var a={},b=!1,c="";a.init=function(a){c=a;$("#newSongBtn").click(function(a){a=$("#songTitle");var g=a.val().trim();a.val(g);a=2<g.length;k(!a,"Song's title is required<br/><em>(you may change it later, must be at least 2 characters)</em>");a&&h()});$("#openNewDlgBtn").click(function(a){$("#songTitle, #songArtist").val("");$("#newSongForm").fadeIn();$("#songTitle").focus()});$("#hideNewSongBtn").click(d);$("#newSongForm").bind("keydown",m);var r=$("#loadingSpinner");r.hide();
$(document).ajaxStart(function(){r.show();b=!0}).ajaxStop(function(){r.hide();b=!1})};var h=function(){if(!b){var a={handler:"ugs_new",songTitle:$("#songTitle").val(),songArtist:$("#songArtist").val()};$.ajax({url:c,type:"POST",dataType:"json",data:JSON.stringify(a),success:function(a){k(a.HasErrors,a.Message);a.HasErrors||(document.location.href=a.ContinueUri)},error:function(a){k(!0,"Failed to create the song file.<br/>Please have your admin check the CPM directory permissions.")}})}},k=function(a,
c){var b=$("#newSongForm .errorMessage");a?(b.show().html(c),$("#songTitle").focus()):b.hide()},d=function(a){$("#newSongForm").fadeOut()},m=function(a){27==a.which&&d()};return a}();
ugsEditorPlus.updateSong=function(){var a={},b="",c="",h=!1;a.init=function(a,m){b=a;c=m;$("#saveBtn").click(function(a){k();return!1});$("#messageBox").hide();$(document).ajaxStart(function(){$("#sourceFeedback").hide().html();$("#messageBox").slideDown("fast");$("#loadingSpinner").show();h=!0}).ajaxStop(function(){$("#messageBox").delay(3E3).fadeOut("slow");h=!1})};var k=function(){if(!h){$("#sourceFeedback").show();var a={handler:"ugs_update_81jr",filename:c,song:$("#chordProSource").val()};$.ajax({url:b,
type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(a){a=a.Message;$("#loadingSpinner").hide();$("#sourceFeedback").show().html(a)}})}};return a}();
ugsEditorPlus.typeahead=function(){var a={},b=[],c={},h="",k,d=[],m=/\s{2,}/g,n=/([^a-z0-9]+)/gi,r=/['`\u2019-]/g,t=function(){$("li").each(function(a){var e=$(this);a=g(e.text());var f=e.children("a").attr("href"),l=f.toLowerCase(),e=e.children("a").html(),e=e.replace('<strong class="','<span class="bigger ').replace("</strong>","</span>");c[l]={html:e,searchText:a,code:l,href:f};b.push(l)})},g=function(a){return a.toLowerCase().replace(r,"").replace(n," ").replace(m," ").trim()},f=function(a,c){h=
g(a);d=h.split(" ");for(var e="",f=0;f<d.length;f++)d[f]=d[f].trim(),0<d[f].length&&(e+=(0<e.length?"|":"")+d[f]);k=RegExp("("+e+")","gi");c(b)},l=function(a){window.location=c[a].href;return c[a].searchText},e=function(a){a=c[a];for(var g=0;g<d.length;g++)if(-1==a.searchText.indexOf(d[g]))return!1;return!0},p=function(a){return a.sort(function(a,g){return c[a].searchText>c[g].searchText})},q=function(a){a=$("<div/>").html(c[a].html);$("em, .bigger",a).each(function(a){a=$(this);var g=a.html();a.html(g.replace(k,
"<strong>$1</strong>"))});return a.html()};a.initialize=function(){t();$("#quickSearch").typeahead({source:f,updater:l,matcher:e,sorter:p,highlighter:q,minLength:2,items:50}).val("").focus()};return a};
ugsEditorPlus.resize=function(){var a={},b=null,c=null,h=null,k=null,d=!1,m=!1,n=function(a){b=$(a);$("body").append('<div id="aceHeader"><button class="aceSideBtn" title="Show options &amp; help"><span></span><span></span><span></span></button><strong>Edit Song</strong><a href="#exit-fullscreen">Exit fullscreen</a></div><div id="aceEditor"></div><div id="aceHelp"></div>');c=$("#aceEditor");c.fadeOut(1);h=$("#aceHelp");$("#aceHeader a").click(function(a){a.preventDefault();e()});$("#aceHeader button").click(r)},
r=function(a){a.preventDefault();t(!m)},t=function(a){(m=a)?(h.animate({left:0},400),c.animate({left:"350px"},400)):(h.animate({left:"-350px"},400),c.animate({left:0},400))},g=function(a){var g="",c,b;a=a.toLowerCase();$("script").each(function(e,f){c=f.src.toLowerCase();b=c.indexOf(a);0<b&&(g=f.src.substr(0,b))});return g},f=function(){d=!0;$("html").addClass("aceEditorActive");$(".overlay").fadeOut(300);if(null!==k)l();else{var a=g("ugsEditorPlus");LazyLoad.js(a+"/ace/ace.js",function(){k=ace.edit("aceEditor");
k.setTheme("ace/theme/idle_fingers");k.getSession().setMode("ace/mode/chordpro");k.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0});k.completers=[ugsAce.chordCompleter];l();h.html(ugsAce.helpHtml)})}},l=function(){c.fadeIn(550);k.setValue($("#chordProSource").val());k.gotoLine(1);h.fadeIn(1)},e=function(){d=!1;b.show();c.fadeOut(550);h.fadeOut(550);null!==k&&$("#chordProSource").val(k.getValue());$("html").removeClass("aceEditorActive");t(!1)};a.toggle=function(a){null===b&&n(a);d?e():
f();return!1};return a}();ugsEditorPlus.chordBuilder=function(){var a={},b=null;a.init=function(){var a=$(".fingerToolImage").css("background-image");ugsChordBuilder.settings.cursor.imageUri=a.replace(/url\("(.*)hand.png"\)/i,"$1hand-cursor.png");b=new ugsChordBuilder.editorUi;b.init();$("#cdBldOpenBtn").click(c)};var c=function(a){a.preventDefault();b.reload();a=$(this).data("dialog");$("#"+a).fadeIn()};return a}();var ugsChordBuilder=window.ugsChordBuilder||{};
ugsChordBuilder.entities={BoundingBox:function(a,b){this.x=a?a.x:0;this.y=a?a.y:0;this.width=b?b.width:1;this.height=b?b.height:1},Dot:function(a,b,c){this.string=a;this.fret=b?b:0;this.finger=c?c:0},Position:function(a,b){this.x=a?a:0;this.y=b?b:0}};
ugsChordBuilder.settings=function(){var a=ugsChordBuilder.entities,b={x:75,y:75},c={numFrets:5,maxFret:16,stringNames:["G","C","E","A"],strokeWidth:4,strokeColor:"#8F8569",fretSpace:35,stringSpace:30},h=function(){return{height:c.fretSpace,width:c.stringSpace}};return{anchorPos:b,cursor:{fillColor:"rgba(220, 216, 73, 0.35)",strokeWidth:1,strokeColor:"#AAB444",radius:9,imageUri:"/img/editor/hand-cursor.png"},fretBoard:c,dot:{fillColor:"#F68014",radius:11,strokeWidth:2,strokeColor:"#D56333",fontWeight:"bold",
fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:16,fontColor:"#ffffff"},fretLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:28,color:"#6A6A63",lightColor:"#EAEAE8"},stringLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:34,color:"#DCD849"},chord:{nameMaxLength:20},targetDimensions:h,targetAnchorPos:function(){var k=h();return new a.Position(b.x-0.5*k.width,b.y-k.height-0.2*c.strokeWidth)},centerAnchor:function(a){b.x=
0.5*a.width-0.5*(c.stringNames.length-1)*c.stringSpace-c.strokeWidth;b.y=0.5*a.height-0.5*c.numFrets*c.stringSpace}}}();
ugsChordBuilder.tracking=function(){var a=ugsChordBuilder.entities,b=ugsChordBuilder.settings,c={},h=null;c.toDot=function(c){var d=new a.BoundingBox(c),m;h||(m=b.targetDimensions(),m.width*=b.fretBoard.stringNames.length,m.height*=b.fretBoard.numFrets+1,h=new a.BoundingBox(b.targetAnchorPos(),m));m=h;if(!(d.x<m.x+m.width&&d.x+d.width>m.x&&d.y<m.y+m.height&&d.y+d.height>m.y))return null;d=b.targetDimensions();return new a.Dot(Math.floor((c.x-m.x)/d.width),Math.floor((c.y-m.y)/d.height))};return c}();
ugsChordBuilder.fretDots=function(){var a=ugsChordBuilder.entities,b=ugsChordBuilder.settings.anchorPos,c=ugsChordBuilder.settings.fretBoard,h=ugsChordBuilder.settings.dot,k={},d=[];k.getDots=function(){return d.slice()};k.slide=function(a){var b;a:{for(b=0;b<d.length;b++)if(1>d[b].fret+a||d[b].fret+a>c.numFrets){b=!1;break a}b=!0}if(!b)return!1;for(b=0;b<d.length;b++)d[b].fret+=a;return!0};k.toggleDot=function(a){if(0==a.fret)n(a.string);else{var b=m(a);0>b?d.push(a):d.splice(b,1)}};k.toggleFinger=
function(a,b){var g=m(a);if(0>g)return!1;d[g].finger=d[g].finger==b?0:b;return!0};k.reset=function(){for(var a=0;a<c.stringNames.length;a++)n(a)};var m=function(a){for(var b=d.length-1;0<=b;b--)if(d[b].string==a.string&&d[b].fret==a.fret)return b;return-1},n=function(a){for(var b=d.length-1;0<=b;b--)d[b].string==a&&d.splice(b,1)};k.draw=function(k){for(var m=d.length-1;0<=m;m--){var g;g=d[m];g=new a.Position(b.x+0.47*c.strokeWidth+g.string*c.stringSpace,b.y+0.47*c.strokeWidth+(g.fret-0.5)*c.fretSpace);
var f=k,l=g;f.beginPath();f.arc(l.x,l.y,h.radius,0,2*Math.PI,!1);f.fillStyle=h.fillColor;f.fill();f.lineWidth=h.strokeWidth;f.strokeStyle=h.strokeColor;f.stroke();0<d[m].finger&&(f=k,l=d[m].finger,f.font=h.fontWeight+" "+h.fontSize+"px "+h.fontFamily,f.textAlign="center",f.fillStyle=h.fontColor,f.fillText(l,g.x,g.y+0.3*h.fontSize))}};return k}();
ugsChordBuilder.cursorCanvas=function(){var a=ugsChordBuilder.settings.cursor,b=ugsChordBuilder.settings.dot,c={},h=null,k=null,d=!1,m=!0,n=1,r={x:0,y:0};c.init=function(a){h=a;t()};var t=function(){k=new Image;k.onload=function(){d=!0};k.src=a.imageUri};c.setCursor=function(a,b){m=a;n=b};c.draw=function(c){var f=a.radius+a.strokeWidth;h.clearRect(r.x-f,r.y-f,f+50,f+60);!d||m?(h.beginPath(),h.arc(c.x,c.y,a.radius,0,2*Math.PI,!1),h.fillStyle=a.fillColor,h.fill(),h.lineWidth=a.strokeWidth,h.strokeStyle=
a.strokeColor,h.stroke()):(h.drawImage(k,c.x,c.y),h.font=b.fontWeight+" "+b.fontSize+"px "+b.fontFamily,h.textAlign="left",h.fillStyle="black",h.fillText(n,c.x+0.8*k.width,c.y+k.height));r=c};return c}();
ugsChordBuilder.chordCanvas=function(){var a=ugsChordBuilder.entities,b=ugsChordBuilder.settings.centerAnchor,c=ugsChordBuilder.settings.anchorPos,h=ugsChordBuilder.settings.fretLabel,k=ugsChordBuilder.settings.stringLabel,d=ugsChordBuilder.settings.fretBoard,m={},n=null,r=null;m.init=function(a,c){n=a;r=c;b(r)};m.draw=function(b,g){n.clearRect(0,0,r.width,r.height);for(var f=new a.Position(c.x-0.3*h.fontSize,c.y+h.fontSize),l=1<g?h.color:h.lightColor,e=0;e<d.numFrets;e++){var p=g+e,m=f;n.font=h.fontSize+
"px "+h.fontFamily;n.textAlign="right";n.fillStyle=l;n.fillText(p,m.x,m.y);f.y+=d.fretSpace;l=h.lightColor}f=new a.Position(c.x+0.5*d.strokeWidth,c.y-0.25*h.fontSize);for(e=0;e<d.stringNames.length;e++)p=d.stringNames[e],l=f,n.font=k.fontSize+"px "+k.fontFamily,n.textAlign="center",n.fillStyle=k.color,n.fillText(p,l.x,l.y),f.x+=d.stringSpace;e=d.strokeWidth/2;p=d.numFrets*d.fretSpace;l=(d.stringNames.length-1)*d.stringSpace;n.beginPath();for(f=1;f<d.stringNames.length-1;f++)m=c.x+f*d.stringSpace+
e,n.moveTo(m,c.y+e),n.lineTo(m,c.y+p+e);for(f=1;f<d.numFrets;f++)m=c.y+f*d.fretSpace+e,n.moveTo(c.x+e,m),n.lineTo(c.x+l+e,m);n.rect(c.x+e,c.y+e,l,p);n.strokeStyle=d.strokeColor;n.lineWidth=d.strokeWidth;n.stroke();n.closePath();ugsChordBuilder.fretDots.draw(n)};return m}();
ugsChordBuilder["export"]=function(){var a=ugsChordBuilder.settings.fretBoard,b=ugsChordBuilder.settings.chord,c={},h=null,k=function(a,b){this.string=a;this.dots=b?b:[]},d=function(){var b,c=[];for(b=1;b<=a.stringNames.length;b++)c.push(new k(b));var l=ugsChordBuilder.fretDots.getDots();for(b=c.length-1;0<=b;b--)for(var e=l.length-1;0<=e;e--)c[b].string==l[e].string+1&&c[b].dots.push(l[e]);return c},m=function(a){for(var b=0,c=900,e=a.length-1;0<=e;e--)a[e].fret>b&&(b=a[e].fret),a[e].fret<c&&(c=
a[e].fret);return{max:b,min:900>c?c:b}},n=function(a){return 0<a?h+a:0},r=function(a,b){for(var c=0;c<a.length;c++)if(a[c].fret==b)return a[c].finger;return 0};c.getPrimaryFrets=function(a){h=a-1;a=d();for(var b=[],c=0;c<a.length;c++){var e=m(a[c].dots);b.push(n(e.max))}return b};c.getDefinition=function(a,b){var c=(a=t(a))&&0<a.length?a:"CHORDNAME",e="",k="",q="";h=b-1;for(var s=d(),x=0;x<s.length;x++){var w=m(s[x].dots),e=e+(n(w.max)+" "),k=k+(r(s[x].dots,w.max)+" ");w.max!=w.min&&(q+=" add: string "+
s[x].string+" fret "+n(w.min)+" finger "+r(s[x].dots,w.min))}return("{define: "+c+" frets "+e+" fingers "+k+q+"}").replace(/\s+/g," ").replace(" }","}")};c.getDefinitionHtml=function(a,b){a=t(a);var d=c.getDefinition(a,b),d=d.replace(" "+a," X07Myq791wso01"),d=d.replace(/\b(\d+)\b/g,'<span class="chordPro-X07MX001number">$1</span>'),d=d.replace(/\b(frets?|fingers?|string)\b/g,'<span class="chordPro-X07MX001attribute">$1</span>'),d=d.replace(/\b(define|add)\b/g,'<span class="chordPro-X07MX001keyword">$1</span>');
return d.replace("X07Myq791wso01",'<span class="chordPro-string">'+a+"</span>").replace(/X07MX001/g,"").replace(/ +/g," ")};var t=function(a){a=a.replace(/^\s*(.*?)\s*$/,"$1").replace(/\s+/g,"-");/^(frets|fingers|add:)$/i.test(a)&&(a="");return a.substring(0,b.nameMaxLength)};return c}();
ugsChordBuilder.chooserList=function(){var a={},b=[],c=null,h=0,k=null,d=function(){},m=null,n={showText:!1,height:50,width:40,fretSpace:9,stringSpace:7,dotRadius:3,lineWidth:1,topLeftPos:{x:10,y:2},xWidth:0.7*7,xStroke:1.4},r={dot:"8pt Arial",text:"8pt Arial",fret:"8pt Arial"},t={fretLines:"#EED18E",dots:"#551D00",dotText:"#ffffff",text:"#000000",fretText:"#EED18E",xStroke:"#551D00"},g=function(a,b){this.id=h++;this.name=a;this.definition=b};a.init=function(a){d=a;c=document.getElementById("cdBldPick");
c.addEventListener("click",l,!1);f()};var f=function(){for(var a=/\{define:\s*([^}]+?)\s+frets[^}]+?\}/im,e=document.getElementById("chordProSource").value.split("\n"),d=e.length-1;0<=d;d--)a.test(e[d])&&A(e[d].replace(a,"$1"),e[d]);for(var e=c,d=b,f="",a=0;a<d.length;a++)f+=p(d[a].id,d[a].name);e.innerHTML='<li data-id="-1" class="newChord">+ Add New Chord</li>'+f;e=e.getElementsByTagName("li");for(a=e.length-1;0<=a;a--)1>a||q(e[a].getAttribute("data-id"))};a.reset=function(){b=[];document.getElementById("cdBldPick").innerHTML=
"";h=0;k=null;f()};a.show=function(a){document.getElementById("cdBldChooserPanel").style.display=a?"block":"none";document.getElementById("cdBldBuilderPanel").style.display=a?"none":"block";$("#cdBldChooserPanel").closest(".overlay").toggleClass("chordBuilderNarrow",a)};a.save=function(d){var f;a:{f=null==k?-1:k.id;for(var g=d.name.toLowerCase(),h=b.length-1;0<=h;h--)if(""+b[h].id!=""+f&&b[h].name.toLowerCase()==g){f=h;break a}f=-1}if(0<=f)return alert("Hey, this chord name is already being used."),
!1;f=-1;if(null==k){f=A(d.name,d.definition);k=z(f);d=d.definition;for(var g=document.getElementById("chordProSource"),h=/\s*\{\s*(title|t|artist|subtitle|st|album|define):.*?\}/im,l=g.value.split("\n"),m="",n=!1,s=l.length-1;0<=s;s--)!n&&h.test(l[s])&&(m=d+"\n"+m,n=!0),m=l[s]+"\n"+m;n||(m=d+"\n"+g.value);g.value=m;ugsEditorPlus.actions.run()}else{g=w(k.id);if(0>g)return!1;h=b[g].definition;b[g].name=d.name;b[g].definition=d.definition;f=b[g].id;x(h,b[g].definition)}d=z(f);(g=e(f))?g.innerHTML=p(f,
d.name,!0):(d=d.name,g=document.createElement("ul"),g.innerHTML=p(f,d),c.appendChild(g.childNodes[0]));q(f);a.show(!0);return!0};var l=function(b){b.preventDefault();k=z(b.target.getAttribute("data-id"));if("delete"==b.target.getAttribute("data-action")){if(b=k,confirm('Delete definition for "'+b.name+'"?')){var f=e(b.id);f&&(c.removeChild(f),x(b.definition,""))}}else{b=null;if(null!=k){b=ukeGeeks.chordImport.runLine(k.definition);a:{if(b.muted)for(f=0;f<b.muted.length;f++)if(b.muted[f]){f=!0;break a}f=
!1}f&&alert("Uh-oh! This chord uses muted strings!\nCurrently the Chord Builder does not support muted strings -- \nsaving edits will result in mutes being lost.")}d(b);a.show(!1)}},e=function(a){for(var b=c.getElementsByTagName("li"),e=0;e<b.length;e++)if(b[e].getAttribute("data-id")==""+a)return b[e];return null},p=function(a,b,c){c=2<arguments.length?c:!1;var e='<span class="deleteChord" data-id="'+a+'" data-action="delete" title="Remove this definition"></span>'+b;return c?e:'<li data-id="'+a+
'" title="Edit this definition" class="ugs-grouped">'+e+"</li>"},q=function(a){var b=e(a);a=z(a);a=ukeGeeks.chordImport.runLine(a.definition);null==m&&(m=new ukeGeeks.chordBrush);m.plot(b,a,n,r,t)},s=function(a,b,c){var e=a.replace(b,c);return e==a?a:s(e,b,c)},x=function(a,b){var c=document.getElementById("chordProSource");c.value=s(c.value,a,b);ugsEditorPlus.actions.run()},w=function(a){for(var c=0;c<b.length;c++)if(""+b[c].id==a)return c;return-1},z=function(a){a=w(a);return 0<=a?b[a]:null},A=function(a,
c){var e=new g(a,c);b.push(e);return e.id};return a}();
ugsChordBuilder.editorUi=function(){var a=null,b=null,c=null,h=1,k="",d=!0,m=0,n={0:"None",1:"Index finger",2:"Middle finger",3:"Ring finger",4:"Pinkie"};this.init=function(){a=document.getElementById("cdBldCursorCanvas");if(!a.getContext)return!1;for(var e=a.getContext("2d"),d=document.getElementById("cdBldDiagramCanvas").getContext("2d"),h=document.getElementById("cdBldStartingFret"),k="",m=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1,n=1;n<=m;n++)k+=
'<option value="'+n+'">'+n+"</option>";h.innerHTML=k;h.addEventListener("change",x,!1);document.getElementById("cdBldChordName").addEventListener("keyup",s,!1);b=document.getElementById("cdBldDotsBtn");c=document.getElementById("cdBldFingersBtn");b.addEventListener("click",p,!1);c.addEventListener("click",p,!1);document.getElementById("cdBldShowOutputBtn").addEventListener("click",t,!1);document.getElementById("cdBldCancelBtn").addEventListener("click",g,!1);document.getElementById("cdBldSaveBtn").addEventListener("click",
f,!1);document.getElementById("toolboxSlideUpBtn").addEventListener("click",w,!1);document.getElementById("toolboxSlideDownBtn").addEventListener("click",w,!1);r();document.getElementById("cdBldEditorSurface").addEventListener("mousemove",z,!1);a.addEventListener("click",A,!1);ugsChordBuilder.chordCanvas.init(d,a);ugsChordBuilder.cursorCanvas.init(e);y();u();ugsChordBuilder.chooserList.init(l);return!0};var r=function(){m++;4<m&&(m=0);document.getElementById("cdBldBtnFingerName").innerHTML=n[m]+" ("+
m+")";document.getElementById("cdBldBtnDiagram").className="fingerToolImage finger"+m},t=function(a){q(document.getElementById("cdBldOutputBox"),"collapseOutput",!a.target.checked)},g=function(a){a.preventDefault();e();ugsChordBuilder.chooserList.show(!0)},f=function(a){a.preventDefault();a={name:k,startingFret:h,dots:ugsChordBuilder.fretDots.getDots(),definition:ugsChordBuilder["export"].getDefinition(k,h)};ugsChordBuilder.chooserList.save(a)||(a=document.getElementById("cdBldChordName"),a.focus(),
a.select())},l=function(a){if(null==a)e();else{var b;b=a.dots;for(var c=0,d=0;d<b.length;d++)b[d].fret>c&&(c=b[d].fret);b=c;b=b>ugsChordBuilder.settings.fretBoard.numFrets?b-ugsChordBuilder.settings.fretBoard.numFrets+1:1;c=e;d=a.name;a=a.dots;for(var f=b-1,g=[],h=0;h<a.length;h++){var k=a[h].fret-f;g.push(new ugsChordBuilder.entities.Dot(a[h].string,0>k?0:k,a[h].finger))}c(d,b,g,!1)}},e=function(a,e,f,g){g=3<arguments.length?g:!0;ugsChordBuilder.fretDots.reset();var l=g;k=a&&0<a.length?a:"CHORDNAME";
document.getElementById("cdBldChordName").value=k;h=e?e:1;document.getElementById("cdBldStartingFret").value=h;document.getElementById("cdBldShowOutputBtn").checked=!1;q(document.getElementById("cdBldOutputBox"),"collapseOutput",!0);document.getElementById("cdBldSaveBtn").value=l?"Add":"Update";d=!0;m=0;r();q(b,"selected",d);q(c,"selected",!d);q(document.getElementById("cdBldToolbox"),"open",!d);ugsChordBuilder.cursorCanvas.setCursor(d,m);if(f&&0<f.length)for(l=0;l<f.length;l++)ugsChordBuilder.fretDots.toggleDot(f[l]);
y();u()},p=function(a){a.preventDefault();a=0<=a.currentTarget.href.indexOf("#dots");a==d?a||(r(),ugsChordBuilder.cursorCanvas.setCursor(d,m)):(q(b,"selected",a),q(c,"selected",!a),q(document.getElementById("cdBldToolbox"),"open",!a),d=a,ugsChordBuilder.cursorCanvas.setCursor(d,m))},q=function(a,b,c){var e=0<=a.className.indexOf(b);c&&!e?a.className+=" "+b:!c&&e&&(a.className=a.className.replace(b,"").replace(/\s+/g," "))},s=function(a){k=this.value;u()},x=function(a){h=parseInt(this.value,10);u();
y()},w=function(a){a.preventDefault();var b=!1;a="up"==a.target.getAttribute("data-direction")?-1:1;if(ugsChordBuilder.fretDots.slide(a))b=!0;else{a=h+a;var c=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1;1<=a&&a<=c&&(h=a,document.getElementById("cdBldStartingFret").value=a,b=!0)}b&&(y(),u())},z=function(a){ugsChordBuilder.cursorCanvas.draw(v(this,a))},A=function(b){b=v(a,b);var c=ugsChordBuilder.tracking.toDot(b);c&&(d?(ugsChordBuilder.fretDots.toggleDot(c),
y(b),u()):ugsChordBuilder.fretDots.toggleFinger(c,m)&&(y(b),u()))},v=function(a,b){var c=a.getBoundingClientRect();return new ugsChordBuilder.entities.Position(b.clientX-c.left,b.clientY-c.top)},y=function(a){a=a||new ugsChordBuilder.entities.Position(0,0);ugsChordBuilder.chordCanvas.draw(a,h)},u=function(){document.getElementById("cdBldOutput").innerHTML=ugsChordBuilder["export"].getDefinitionHtml(k,h)};this.reload=function(){e();ugsChordBuilder.chooserList.reset();ugsChordBuilder.chooserList.show(!0)}};
LazyLoad=function(a){function b(b,c){var d=a.createElement(b),f;for(f in c)c.hasOwnProperty(f)&&d.setAttribute(f,c[f]);return d}function c(a){var b=t[a],c,d;b&&(c=b.callback,d=b.urls,d.shift(),g=0,d.length||(c&&c.call(b.context,b.obj),t[a]=null,f[a].length&&k(a)))}function h(){var b=navigator.userAgent;n={async:!0===a.createElement("script").async};(n.webkit=/AppleWebKit\//.test(b))||(n.ie=/MSIE|Trident/.test(b))||(n.opera=/Opera/.test(b))||(n.gecko=/Gecko\//.test(b))||(n.unknown=!0)}function k(e,
g,k,l,x){var w=function(){c(e)},z="css"===e,A=[],v,y,u,B;n||h();if(g)if(g="string"===typeof g?[g]:g.concat(),z||n.async||n.gecko||n.opera)f[e].push({urls:g,callback:k,obj:l,context:x});else for(v=0,y=g.length;v<y;++v)f[e].push({urls:[g[v]],callback:v===y-1?k:null,obj:l,context:x});if(!t[e]&&(B=t[e]=f[e].shift())){r||(r=a.head||a.getElementsByTagName("head")[0]);g=B.urls.concat();v=0;for(y=g.length;v<y;++v)k=g[v],z?u=n.gecko?b("style"):b("link",{href:k,rel:"stylesheet"}):(u=b("script",{src:k}),u.async=
!1),u.className="lazyload",u.setAttribute("charset","utf-8"),n.ie&&!z&&"onreadystatechange"in u&&!("draggable"in u)?u.onreadystatechange=function(){/loaded|complete/.test(u.readyState)&&(u.onreadystatechange=null,w())}:z&&(n.gecko||n.webkit)?n.webkit?(B.urls[v]=u.href,m()):(u.innerHTML='@import "'+k+'";',d(u)):u.onload=u.onerror=w,A.push(u);v=0;for(y=A.length;v<y;++v)r.appendChild(A[v])}}function d(a){var b;try{b=!!a.sheet.cssRules}catch(f){g+=1;200>g?setTimeout(function(){d(a)},50):b&&c("css");return}c("css")}
function m(){var a=t.css,b;if(a){for(b=l.length;0<=--b;)if(l[b].href===a.urls[0]){c("css");break}g+=1;a&&(200>g?setTimeout(m,50):c("css"))}}var n,r,t={},g=0,f={css:[],js:[]},l=a.styleSheets;return{css:function(a,b,c,d){k("css",a,b,c,d)},js:function(a,b,c,d){k("js",a,b,c,d)}}}(this.document);