/**
 * <ul>
 * <li>Project: UkeGeeks' Song-a-matic Editor</li>
 * <li>Homepage: http://ukegeeks.com</li>
 * <li>Project Repository: https://github.com/buzcarter/UkeGeeks</li>
 * <li>Author: Buz Carter</li>
 * <li>Contact: buz@ukegeeks.com</li>
 * <li>Copyright: Copyright 2010-2014 Buz Carter.</li>
 * <li>License GNU General Public License (http://www.gnu.org/licenses/gpl.html)</li>
 * </ul>
 *
 * <h3>Overview</h3>
 * This library implments the UkeGeeks Scriptasaurus Song-a-matic editor functions, bridging the page UI and scriptasaurus methods.
 *
 * @module ugsEditorPlus
 * @main ugsEditorPlus
 **/
;var ugsEditorPlus=function(){var b={options:{useLegacyIe:!1,showEditOnLoad:!0,fontSize:12,diagramSize:100,diagramPosition:"left",lyricStyle:"above",paper:"letter",theme:"normal",tuning:"soprano",hideChordEnclosures:!1,sortAlphabetical:!1,ignoreCommonChords:!1,commonChords:[]},init:function(a){a=$.extend(b.options,{hideChordEnclosures:!ukeGeeks.settings.opts.retainBrackets,sortAlphabetical:ukeGeeks.settings.opts.sortAlphabetical,ignoreCommonChords:ukeGeeks.settings.opts.ignoreCommonChords,commonChords:ukeGeeks.settings.commonChords},
"object"===typeof a?a:{});ukeGeeks.settings.opts.retainBrackets=!a.hideChordEnclosures;$("#songSourceDlg").toggle(a.showEditOnLoad);ukeGeeks.scriptasaurus.init(a.useLegacyIe);ugsEditorPlus.actions.init();ugsEditorPlus.topMenus.init();ugsEditorPlus.submenuUi.init();ugsEditorPlus.optionsDlg.init();ugsEditorPlus.chordBuilder.init();ugsEditorPlus.actions.run()},attach:function(){b.init({useLegacyIe:!1})},attachIe:function(){b.init({useLegacyIe:!0})}};return b}();
ugsEditorPlus.actions=function(){var b={},a={},c=null,f=null,h=[],d=/^([A-G][#b]?)(m|m6|7|m7|dim|maj7|6|sus2|sus4|aug|9)?$/,g={placement:"above",transpose:"up_0"};b.init=function(){a={songText:document.getElementById("ukeSongText"),songContainer:document.getElementById("ukeSongContainer"),cpmSource:document.getElementById("chordProSource"),scalableArea:document.getElementById("scalablePrintArea")};$(document).on("option:click",function(c,l){var t=l.action,g=l.value,x=!1;switch(t){case "zoomFonts":s(g);
break;case "zoomDiagrams":v(g);break;case "layout":m(g);break;case "placement":x=n(g);break;case "tuning":e(g);x=!0;break;case "colors":ugsEditorPlus.themes.set(g);x=!0;break;case "transpose":t="u"==g[0]?1:-1;g=parseInt(g[g.length-1],10);var g=t*g,z=[],t="",r;for(r=0;r<h.length;r++)d.test(h[r])?z.push(h[r]):t+=h[r]+", ";if(!(0<t.length)||confirm("Sorry, but some of your chords can't be transposed:\n"+t+"\n\nDo you want to continue anyway?")){var y=ukeGeeks.transpose.shiftChords(z,g),t=f,u;for(r=0;r<
z.length;r++)u=RegExp("\\["+z[r]+"\\]","g"),t=t.replace(u,"[ugsxx_"+r+"]");for(r=0;r<y.length;r++)u=RegExp("\\[ugsxx_"+r+"\\]","g"),t=t.replace(u,"["+y[r]+"]");u=/^\s*\{\s*(key|k)\s*:\s*(\S*?)\s*\}\s*$/im;u.test(t)&&(z=t.match(u),r=z[2],""!==r&&d.test(r)&&(t=t.replace(u,z[0].replace(r,ukeGeeks.transpose.shift(r,g)))));a.cpmSource.value=t;b.run()}break;case "paper":k(g);break;case "showEnclosures":ukeGeeks.settings.opts.retainBrackets=g;x=!0;break;case "hideCommonChords":ukeGeeks.settings.opts.ignoreCommonChords=
g;x=!0;break;case "sortAlphabetical":ukeGeeks.settings.opts.sortAlphabetical=g;x=!0;break;case "setCommonChords":p(g);x=ukeGeeks.settings.opts.ignoreCommonChords;break;case "update":b.run(!0);break;default:console.log("Unrecognized "+t+" > "+g)}x&&b.run()});l(ugsEditorPlus.options)};var l=function(a){s(a.fontSize);v(a.diagramSize);m(a.diagramPosition);k(a.paper);ugsEditorPlus.themes.set(a.theme);e(a.tuning);n(a.lyricStyle);ukeGeeks.settings.opts.retainBrackets=!a.hideChordEnclosures;ukeGeeks.settings.opts.ignoreCommonChords=
a.ignoreCommonChords;p(a.commonChords);ukeGeeks.settings.opts.sortAlphabetical=a.sortAlphabetical};b.run=function(m){m=0<arguments.length&&m;a.songText.innerHTML="<pre>"+a.cpmSource.value+"</pre>";c=ukeGeeks.scriptasaurus.run();1>c.chords.length&&ugsEditorPlus.autoReformat.run(a);if(c&&(ugsEditorPlus.songUi.update(c),m||null===f)){f=a.cpmSource.value;h=c.chords;var e=""!==c.key?c.key:1>c.chords.length?"":c.chords[0],d=document.getElementById("transposeOptions").getElementsByTagName("li"),b,n=-6;g.transpose=
"up_0";ugsEditorPlus.submenuUi.resetTransposeLabel();for(var k=0;k<d.length;k++)ukeGeeks.toolsLite.removeClass(d[k],"checked"),b=1>e.length?"":ukeGeeks.transpose.shift(e,n),d[k].getElementsByTagName("em")[0].innerHTML=b,0===n&&ukeGeeks.toolsLite.addClass(d[k],"checked"),n++}};var s=function(c){c=parseFloat(c,10);a.scalableArea.style.fontSize=c+"pt"},v=function(a){a=parseInt(a,10)/100;var c=Math.round(225*a),m=ugsEditorPlus.styles.getSheet("ugsEditorCss"),e=m.find(".scalablePrintArea .ugs-diagrams-wrap canvas");
e.style.width=Math.round(a*ukeGeeks.settings.fretBox.width)+"px";e.style.height=Math.round(a*ukeGeeks.settings.fretBox.height)+"px";e=m.find(".scalablePrintArea .ugs-diagrams-wrap");e.style.width=c+"px";e=m.find(".scalablePrintArea .ugs-source-wrap");e.style.marginLeft=25+c+"px"},m=function(a){$("body").toggleClass("diagramsOnTop","top"==a).toggleClass("diagramsOnSide","left"==a).toggleClass("ugsHideDiagrams","none"==a)},n=function(c){var m=!1;ukeGeeks.toolsLite.setClass(a.songContainer,"ugsInline",
"inline"==c);var e="miniDiagrams"==c;e||ukeGeeks.toolsLite.removeClass(a.songContainer,"ugsInlineDiagrams");e||"miniDiagrams"==g.placement?(ukeGeeks.settings.inlineDiagrams=e,m=!0):e||"miniDiagrams"==g.placement||ukeGeeks.overlapFixer.Fix(a.songText);g.placement=c;return m},k=function(a){for(var c=["letter","a4","screen"],m=$("body"),e=0;e<c.length;e++)m.removeClass("pageWidth_"+c[e]);m.addClass("pageWidth_"+a)},e=function(a){var c=ukeGeeks.definitions.instrument.sopranoUke,m="Standard <strong>GCEA</strong> Soprano Ukulele";
"baritone"==a&&(c=ukeGeeks.definitions.instrument.baritoneUke,m="Standard <strong>DGBE</strong> Baritone Ukulele");$("#footTuningInfo").html(m);ukeGeeks.scriptasaurus.setTuningOffset(c)},p=function(a){if("string"==typeof a){a=a.split(/[ ,]+/);for(var c=[],m=0;m<a.length;m++){var e=ukeGeeks.toolsLite.trim(a[m]);0<e.length&&c.push(e)}a=c}ukeGeeks.settings.commonChords=a};return b}();
ugsEditorPlus.songUi=function(){var b={},a=function(a,f){var b=f&&0<f.length,d=document.getElementById(a);d&&(d.innerHTML=b?f:"",d.style.display=b?"block":"none")};b.update=function(c){var f=document.getElementById("songTitle");f.innerHTML=0<c.title.length?c.title:"Untitled-Song";a("songArtist",c.artist);a("songAlbum",c.album);a("songSubtitle",c.st);f=document.getElementById("songMeta");if(!c.ugsMeta||1>c.ugsMeta.length)f.style.display="none";else{for(var b="",d=0;d<c.ugsMeta.length;d++)b+="<p>"+
c.ugsMeta[d]+"</p>";f.innerHTML=b;f.style.display="block"}};return b}();
ugsEditorPlus.styles=function(){var b={Rules:null},a=null;b.getSheet=function(c){a:{for(var f=0;f<document.styleSheets.length;f++)if(document.styleSheets[f].title==c){a=document.styleSheets[f];break a}a=null}c=null==a?[]:a.cssRules?a.cssRules:a.rules;b.Rules=c;return this};b.find=function(a){a=a.toLowerCase();for(var f=0;f<b.Rules.length;f++)if(b.Rules[f].selectorText&&b.Rules[f].selectorText.toLowerCase()==a)return b.Rules[f];return null};return b}();
ugsEditorPlus.themes=function(){var b={},a={normal:{name:"Normal (white paper)",selectText:"Normal colors (white paper)",description:"Simple, legible text on white paper",song:{fretLines:"#003366",dots:"#ff0000",dotText:"#ffffff",text:"#000000",fretText:"#4a4a4a"},tabs:{lines:"#999999",dots:"#eaeaea",text:"#000000"}},reversed:{name:"Reversed for projectors",selectText:"Reversed colors (for projectors)",description:"Light text on dark background",song:{fretLines:"#365F70",dots:"#FDD96F",dotText:"#000000",
text:"#FF6040",fretText:"#999999"},tabs:{lines:"#365F70",dots:"#FDD96F",text:"#000000"}},frosty:{name:"Frostcicle",selectText:"Frostcicle (cool blue)",description:"Brrrr... icy cool blues",song:{fretLines:"#66B4CC",dots:"#332335",dotText:"#9FE1F9",text:"#0896FE",fretText:"#E3D8BA"},tabs:{lines:"#6699FF",dots:"#EFFCF9",text:"#00558E"}},jellyBean:{name:"Jelly Beans",selectText:"Jelly Beans (vibrant)",description:"Sugary, vibrant bowl of jelly beans!",song:{fretLines:"#49BC45",dots:"#FF9417",dotText:"#FCF49F",
text:"#D20070",fretText:"#4a4a4a"},tabs:{lines:"#6699FF",dots:"#FFF9BA",text:"#75003E"}},justBlack:{name:"Just Black",selectText:"Black (for laser printers)",description:"No color, but black, best for B&W laser printers",song:{fretLines:"#cccccc",dots:"#000000",dotText:"#ffffff",text:"#000000",fretText:"#000000"},tabs:{lines:"#cccccc",dots:"#000000",text:"#ffffff"}},krampus:{name:"Gruss vom Krampus",selectText:"Krampus (Ye Olde Christmas)",description:"Seasons Greetin's, Happy Holidays, Merry Christmas, Krampus Nichte!",
song:{fretLines:"#929867",dots:"#A22C27",dotText:"#EBD592",text:"#4F2621",fretText:"#4a4a4a"},tabs:{lines:"#B69C01",dots:"#E1EEC8",text:"#75003E"}},western:{name:"Out West",selectText:"Out West (dust country)",description:"Dusty Honky Tonk/Country/Western look",song:{fretLines:"#B5A679",dots:"#CF8300",dotText:"#ffffff",text:"#386571",fretText:"#4a4a4a"},tabs:{lines:"#697665",dots:"#F1E3C5",text:"#632424"}},pumpkin:{name:"Pumpkin Pie",selectText:"Pumpkin Pie (fall colors)",description:"Fall 'n Halloween 'n Jack o'Lantern 'n Thanksgiving Fun",
song:{fretLines:"#8E9A6C",dots:"#DA6328",dotText:"#FFEE4A",text:"#68391D",fretText:"#B14623"},tabs:{lines:"#BED379",dots:"#FFF4D8",text:"#B14623"}},notebook:{name:"Rock Notebook",selectText:"Rock Notebook (marker)",description:"A strong, hand-scrawled, and edgily unreliable look",song:{fretLines:"#747CAD",dots:"#1C0866",dotText:"#ffffff",text:"#B22000",fretText:"#A4A0B2"},tabs:{lines:"#A4A0B2",dots:"#F1E3C5",text:"#2E2ECC"}},zombie:{name:"Zombies!!!",selectText:"Zombies!!!",description:"Blood 'n gore for Halloween",
song:{fretLines:"#9EB036",dots:"#E52501",dotText:"#FEDA79",text:"#798666",fretText:"#B14623"},tabs:{lines:"#602749",dots:"#F7F9EA",text:"#4F5F3E"}}};b.getDescription=function(c){return a[c].selectText};b.loadList=function(c,b){var h="",d;for(d in a)a.hasOwnProperty(d)&&(h+='<li class="'+(d==b?"checked":"")+'"><a href="#'+d+'" title="'+a[d].description+'">'+a[d].name+"</a></li>");$(c).html(h)};b.set=function(c){var b=$("body"),h;for(h in a)a.hasOwnProperty(h)&&b.removeClass("theme-"+h);b.addClass("theme-"+
c);c=a[c];ukeGeeks.settings.colors=c.song;ukeGeeks.settings.tabs.lineColor=c.tabs.lines;ukeGeeks.settings.tabs.dotColor=c.tabs.dots;ukeGeeks.settings.tabs.textColor=c.tabs.text};return b}();
ugsEditorPlus.optionsDlg=function(){var b=function(a,c){$.event.trigger("option:click",{action:a,value:c})};return{init:function(){var a,c=ugsEditorPlus.options;document.getElementById("updateBtn").onclick=function(){b("update","");return!1};a=document.getElementById("chkEnclosures");a.checked=c.hideChordEnclosures;a.onclick=function(){b("showEnclosures",!this.checked)};a=document.getElementById("commonChordList");a.value="string"==typeof c.commonChords?c.commonChords:c.commonChords.join(", ");a.onchange=
function(){b("setCommonChords",this.value)};if(a=document.getElementById("chkSortAlpha"))a.checked=c.sortAlphabetical,a.onclick=function(){b("sortAlphabetical",this.checked)};a=document.getElementById("chkIgnoreCommon");a.checked=c.ignoreCommonChords;a.onclick=function(){b("hideCommonChords",this.checked)};$(".checkboxBlock label, input[type=checkbox]").click(function(a){a.stopPropagation()});$(".overlay").draggable({handle:"hgroup"})}}}();ugsEditorPlus=window.ugsEditorPlus||{};
ugsEditorPlus.reformat=function(){var b={},a=!1,c=function(){this.source="";this.spaceCount=this.wordCount=0;this.words=[];this.lineType=this.chordCount=0},f=/\b(\S+)\b/gi,h=/(\s+)/g,d=/(^\s+)/,g=/\b[A-G][#b]?(m|m6|m7|m9|dim|dim7|maj7|sus2|sus4|aug|6|7|9|add9|7sus4)?\b/,l=/\b(\S+\s*)/g,s=/^\s*(\|{0,2}[A-Gb]?\|{0,2}[-x0-9|:]{4,})/;b.run=function(b){a=!1;var m=[];b=b.replace("\t","    ");b=b.split("\n");for(var n=0;n<b.length;n++){var k=b[n].match(f),e=new c;e.source=b[n];if(null!=k&&0<k.length){e.wordCount=
k.length;e.words=k;for(var p=e,q=0,w=0;w<k.length;w++)k[w].match(g)&&q++;p.chordCount=q}p=b[n].match(h);null!=p&&0<p.length&&(e.spaceCount=p.length);p=e;k=e;1>k.spaceCount+k.wordCount?k=0:null!=k.source.match(s)?k=3:(q=2,0<k.chordCount&&k.wordCount==k.chordCount&&(q=1,a=!0),k=q);p.lineType=k;m.push(e)}n="";for(b=0;b<m.length;)if(e=m[b],p=m[b+1],b++,p&&0!=e.lineType){if(k=3==e.lineType)a:if(b+3>=m.length)k=!1;else{for(k=b;k<b+3;k++)if(3!=m[k].lineType){k=!1;break a}k=!0}if(k)n+="{start_of_tab}\n"+
e.source.replace(d,"")+"\n"+p.source.replace(d,"")+"\n"+m[b+1].source.replace(d,"")+"\n"+m[b+2].source.replace(d,"")+"\n{end_of_tab}\n",b+=3;else if(1!=e.lineType||2!=p.lineType){if(1==e.lineType){e=e.source.replace(h," ").split(" ");p="";for(k=0;k<e.length;k++)0<e[k].length&&(p+="["+e[k]+"] ");e=p+"\n"}else e=e.source+"\n";n+=e}else{b++;q=e.source;for(e=p.source;e.length<q.length;)e+=" ";p="";k=q.match(l);w=q.match(d);q=0;w&&(p+=e.substr(q,w[0].length),q=w[0].length);for(w=0;w<k.length;w++)p+="["+
k[w].replace(h,"")+"]"+e.substr(q,k[w].length),q+=k[w].length;q<e.length&&(p+=e.substr(q,e.length));n+=p+"\n"}}else n+=e.source+"\n";return n};b.hasChords=function(){return a};return b}();
ugsEditorPlus.autoReformat=function(){var b={},a={},c,f=!1;b.run=function(b){f||(a=b,a.reformatTextBox=document.getElementById("reformatSource"),a.reformatDlg=document.getElementById("reformatDlg"),document.getElementById("reformatYesBtn").onclick=function(){a.cpmSource.value=c;h();ugsEditorPlus.actions.run(!0);return!1},document.getElementById("reformatNoBtn").onclick=function(){h();return!1},b=document.getElementById("reformatDisable"),b.checked=!1,b.onclick=function(){f=this.checked},c=ugsEditorPlus.reformat.run(a.cpmSource.value),
a.reformatTextBox.innerHTML=c,ugsEditorPlus.reformat.hasChords()&&ukeGeeks.toolsLite.removeClass(a.reformatDlg,"isHidden"))};var h=function(){ukeGeeks.toolsLite.addClass(a.reformatDlg,"isHidden")};return b}();
ugsEditorPlus.topMenus=function(){var b=function(){var c=$(this).parent(),b=c.hasClass("active");a();b||c.addClass("active")},a=function(){$("#ugsAppToolbar > ul > li").removeClass("active")},c=function(){a();$(".arrowBox").hide()},f=function(a){c();a=$(this).data("dialog");$("#"+a).fadeIn();return!1},h=function(a){$(this).parents(".overlay").fadeOut();return!1},d=function(a){c();a=$(this).parents(".overlay");ugsEditorPlus.resize.toggle(a);return!1},g=function(a){a=$(this).attr("href");$(".arrowBox").not(a).hide();
a=$(a);a.find("dd").hide();a.fadeToggle();ugsEditorPlus.submenuUi.reset(a);return!1};return{init:function(){$("#ugsAppToolbar > ul li").not("[data-dialog]").children("a").click(b);$(".showOptionsBox a").click(g);$("#ugsAppToolbar > ul li[data-dialog]").click(f);$(".closeBtn").click(h);$(".resizeBtn").click(d)},makeAllInactive:a}}();
ugsEditorPlus.submenuUi=function(){var b={},a=null;b.init=function(){ugsEditorPlus.themes.loadList("#colorPicker .pseudoSelect",ugsEditorPlus.options.theme);$(".enablePseudoSelects label").click(h);$(".pseudoSelect li").click(c);$("body").bind("click",l);$(".arrowBox").click(g);for(var a=ugsEditorPlus.options,b,d=[{action:"zoomFonts",value:a.fontSize},{action:"zoomDiagrams",value:a.diagramSize},{action:"layout",value:a.diagramPosition},{action:"paper",value:a.paper},{action:"colors",value:a.theme},
{action:"tuning",value:a.tuning},{action:"placement",value:a.lyricStyle}],e=d.length-1;0<=e;e--)a=$("[data-action="+d[e].action+"] a[href=#"+d[e].value+"]").closest("li"),b=a.closest("dd").attr("id"),f(a),$("label[for="+b+"] span").text(v(d[e].action,d[e].value,a))};var c=function(c){c=$(this);var b;b=c.children().attr("href");b="#"==b[0]?b.substr(1):b;var k=c.parents("dd"),e=k.attr("id"),k=k.data("action");$("#"+e).hide();f(c);d(this,!1);a=null;$("label[for="+e+"] span").text(v(k,b,c));$("label[for="+
e+"]").parents("dt").removeClass("active");$.event.trigger("option:click",{action:k,value:b});return!1},f=function(a){a&&(a.siblings().removeClass("checked"),a.addClass("checked"))},h=function(c){c=$(this);var b=c.attr("for");c.closest("dl").children("dt").removeClass("active");c.closest("dt").addClass("active");$("#"+b).show();d(this,!0);null!==a&&$("#"+a.id).hide();a=null!==a&&a.id==b?null:{id:b};return!1};b.reset=function(a){a.find("dt").removeClass("active");a.find(".event-userSelecting").removeClass("event-userSelecting")};
var d=function(a,c){$(a).parents(".enablePseudoSelects").toggleClass("event-userSelecting",c)},g=function(c){if(!$(c.target).is("a"))return $(this).find("dd").hide(),a=null,!1},l=function(a){$(".arrowBox").fadeOut(270);ugsEditorPlus.topMenus.makeAllInactive()},s={zoomDiagrams:["Tiny","Small","Medium","Large","Stupid Large"],layout:["Reference diagrams on left","Reference diagrams at top","No reference diagrams"],placement:["Chord names inline with lyrics","Chord names above lyrics","Names & diagrams above lyrics"],
tuning:["Soprano (GCEA) tuning","Baritone (DBEA) tuning"]},v=function(a,c,b){var e=b.index();switch(a){case "paper":return"Width "+b.text();case "zoomFonts":return"Font size "+c+"pt";case "zoomDiagrams":return s.zoomDiagrams[e]+" diagrams";case "colors":return ugsEditorPlus.themes.getDescription(c);case "transpose":return"up_0"==c?"Original key":b.text().replace(" ",' steps - "')+'"';default:return s[a][e]}};b.resetTransposeLabel=function(){$("label[for=transposePicker] span").text("Original key")};
return b}();
ugsEditorPlus.newSong=function(){var b={},a=!1,c="";b.init=function(b){c=b;$("#newSongBtn").click(function(a){a=$("#songTitle");var c=a.val().trim();a.val(c);a=2<c.length;h(!a,"Song's title is required<br/><em>(you may change it later, must be at least 2 characters)</em>");a&&f()});$("#openNewDlgBtn").click(function(a){$("#songTitle, #songArtist").val("");$("#newSongForm").fadeIn();$("#songTitle").focus()});$("#hideNewSongBtn").click(d);$("#newSongForm").bind("keydown",g);var s=$("#loadingSpinner");s.hide();
$(document).ajaxStart(function(){s.show();a=!0}).ajaxStop(function(){s.hide();a=!1})};var f=function(){if(!a){var b={handler:"ugs_new",songTitle:$("#songTitle").val(),songArtist:$("#songArtist").val()};$.ajax({url:c,type:"POST",dataType:"json",data:JSON.stringify(b),success:function(a){h(a.HasErrors,a.Message);a.HasErrors||(document.location.href=a.ContinueUri)},error:function(a){h(!0,"Failed to create the song file.<br/>Please have your admin check the CPM directory permissions.")}})}},h=function(a,
c){var b=$("#newSongForm .errorMessage");a?(b.show().html(c),$("#songTitle").focus()):b.hide()},d=function(a){$("#newSongForm").fadeOut()},g=function(a){27==a.which&&d()};return b}();
ugsEditorPlus.updateSong=function(){var b={},a="",c="",f=!1;b.init=function(b,g){a=b;c=g;$("#saveBtn").click(function(a){h();return!1});$("#messageBox").hide();$(document).ajaxStart(function(){$("#sourceFeedback").hide().html();$("#messageBox").slideDown("fast");$("#loadingSpinner").show();f=!0}).ajaxStop(function(){$("#messageBox").delay(3E3).fadeOut("slow");f=!1})};var h=function(){if(!f){$("#sourceFeedback").show();var b={handler:"ugs_update_81jr",filename:c,song:$("#chordProSource").val()};$.ajax({url:a,
type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(b),success:function(a){a=a.Message;$("#loadingSpinner").hide();$("#sourceFeedback").show().html(a)},error:function(a){alert("Encountered a problem saving your Song. Please copy your song to another program until this issue is resolved.")}})}};return b}();
ugsEditorPlus.typeahead=function(){var b={},a=[],c={},f="",h,d=[],g=/\s{2,}/g,l=/([^a-z0-9]+)/gi,s=/['`\u2019-]/g,v=function(){$("li").each(function(b){var e=$(this);b=m(e.text());var d=e.children("a").attr("href"),f=d.toLowerCase(),e=e.children("a").html(),e=e.replace('<strong class="','<span class="bigger ').replace("</strong>","</span>");c[f]={html:e,searchText:b,code:f,href:d};a.push(f)})},m=function(a){return a.toLowerCase().replace(s,"").replace(l," ").replace(g," ").trim()},n=function(b,c){f=
m(b);d=f.split(" ");for(var e="",k=0;k<d.length;k++)d[k]=d[k].trim(),0<d[k].length&&(e+=(0<e.length?"|":"")+d[k]);h=RegExp("("+e+")","gi");c(a)},k=function(a){window.location=c[a].href;return c[a].searchText},e=function(a){a=c[a];for(var b=0;b<d.length;b++)if(-1==a.searchText.indexOf(d[b]))return!1;return!0},p=function(a){return a.sort(function(a,b){return c[a].searchText>c[b].searchText})},q=function(a){a=$("<div/>").html(c[a].html);$("em, .bigger",a).each(function(a){a=$(this);var b=a.html();a.html(b.replace(h,
"<strong>$1</strong>"))});return a.html()};b.initialize=function(){v();$("#quickSearch").typeahead({source:n,updater:k,matcher:e,sorter:p,highlighter:q,minLength:2,items:50}).val("").focus()};return b};
ugsEditorPlus.resize=function(){var b={},a=null,c=null,f=null,h=null,d=!1,g=!1,l=function(b){a=$(b);$("body").append('<div id="aceHeader"><button class="aceSideBtn" title="Show options &amp; help"><span></span><span></span><span></span></button><strong>Edit Song</strong><a href="#exit-fullscreen">Exit fullscreen</a></div><div id="aceEditor"></div><div id="aceHelp"></div>');c=$("#aceEditor");c.fadeOut(1);f=$("#aceHelp");$("#aceHeader a").click(function(a){a.preventDefault();e()});$("#aceHeader button").click(s)},
s=function(a){a.preventDefault();v(!g)},v=function(a){(g=a)?(f.animate({left:0},400),c.animate({left:"350px"},400)):(f.animate({left:"-350px"},400),c.animate({left:0},400))},m=function(a){var b="",c,e;a=a.toLowerCase();$("script").each(function(d,m){c=m.src.toLowerCase();e=c.indexOf(a);0<e&&(b=m.src.substr(0,e))});return b},n=function(){d=!0;$("html").addClass("aceEditorActive");$(".overlay").fadeOut(300);if(null!==h)k();else{var a=m("ugsEditorPlus");LazyLoad.js(a+"/ace/ace.js",function(){h=ace.edit("aceEditor");
h.setTheme("ace/theme/idle_fingers");h.getSession().setMode("ace/mode/chordpro");h.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0});h.completers=[ugsAce.chordCompleter];k();f.html(ugsAce.helpHtml)})}},k=function(){c.fadeIn(550);h.setValue($("#chordProSource").val());h.gotoLine(1);f.fadeIn(1)},e=function(){d=!1;a.show();c.fadeOut(550);f.fadeOut(550);null!==h&&$("#chordProSource").val(h.getValue());$("html").removeClass("aceEditorActive");v(!1)};b.toggle=function(b){null===a&&l(b);d?e():
n();return!1};return b}();ugsEditorPlus.chordBuilder=function(){var b={},a=null;b.init=function(){var b=$(".fingerToolImage").css("background-image");ugsChordBuilder.settings.cursor.imageUri=b.replace(/url\("(.*)hand.png"\)/i,"$1hand-cursor.png");a=new ugsChordBuilder.editorUi;a.init();$("#cdBldOpenBtn").click(c)};var c=function(b){b.preventDefault();a.reload();b=$(this).data("dialog");$("#"+b).fadeIn()};return b}();var ugsChordBuilder=window.ugsChordBuilder||{};
ugsChordBuilder.entities={BoundingBox:function(b,a){this.x=b?b.x:0;this.y=b?b.y:0;this.width=a?a.width:1;this.height=a?a.height:1},Dot:function(b,a,c){this.string=b;this.fret=a?a:0;this.finger=c?c:0},Position:function(b,a){this.x=b?b:0;this.y=a?a:0}};
ugsChordBuilder.settings=function(){var b=ugsChordBuilder.entities,a={x:75,y:75},c={numFrets:5,maxFret:16,stringNames:["G","C","E","A"],strokeWidth:4,strokeColor:"#8F8569",fretSpace:35,stringSpace:30},f=function(){return{height:c.fretSpace,width:c.stringSpace}};return{anchorPos:a,cursor:{fillColor:"rgba(220, 216, 73, 0.35)",strokeWidth:1,strokeColor:"#AAB444",radius:9,imageUri:"/img/editor/hand-cursor.png"},fretBoard:c,dot:{fillColor:"#F68014",radius:11,strokeWidth:2,strokeColor:"#D56333",fontWeight:"bold",
fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:16,fontColor:"#ffffff"},fretLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:28,color:"#6A6A63",lightColor:"#EAEAE8"},stringLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:34,color:"#DCD849"},chord:{nameMaxLength:20},targetDimensions:f,targetAnchorPos:function(){var h=f();return new b.Position(a.x-0.5*h.width,a.y-h.height-0.2*c.strokeWidth)},centerAnchor:function(b){a.x=
0.5*b.width-0.5*(c.stringNames.length-1)*c.stringSpace-c.strokeWidth;a.y=0.5*b.height-0.5*c.numFrets*c.stringSpace}}}();
ugsChordBuilder.tracking=function(){var b=ugsChordBuilder.entities,a=ugsChordBuilder.settings,c={},f=null;c.toDot=function(c){var d=new b.BoundingBox(c),g;f||(g=a.targetDimensions(),g.width*=a.fretBoard.stringNames.length,g.height*=a.fretBoard.numFrets+1,f=new b.BoundingBox(a.targetAnchorPos(),g));g=f;if(!(d.x<g.x+g.width&&d.x+d.width>g.x&&d.y<g.y+g.height&&d.y+d.height>g.y))return null;d=a.targetDimensions();return new b.Dot(Math.floor((c.x-g.x)/d.width),Math.floor((c.y-g.y)/d.height))};return c}();
ugsChordBuilder.fretDots=function(){var b=ugsChordBuilder.entities,a=ugsChordBuilder.settings.anchorPos,c=ugsChordBuilder.settings.fretBoard,f=ugsChordBuilder.settings.dot,h={},d=[];h.getDots=function(){return d.slice()};h.slide=function(a){var b;a:{for(b=0;b<d.length;b++)if(1>d[b].fret+a||d[b].fret+a>c.numFrets){b=!1;break a}b=!0}if(!b)return!1;for(b=0;b<d.length;b++)d[b].fret+=a;return!0};h.toggleDot=function(a){if(0==a.fret)l(a.string);else{var b=g(a);0>b?d.push(a):d.splice(b,1)}};h.toggleFinger=
function(a,b){var c=g(a);if(0>c)return!1;d[c].finger=d[c].finger==b?0:b;return!0};h.reset=function(){for(var a=0;a<c.stringNames.length;a++)l(a)};var g=function(a){for(var b=d.length-1;0<=b;b--)if(d[b].string==a.string&&d[b].fret==a.fret)return b;return-1},l=function(a){for(var b=d.length-1;0<=b;b--)d[b].string==a&&d.splice(b,1)};h.draw=function(h){for(var g=d.length-1;0<=g;g--){var m;m=d[g];m=new b.Position(a.x+0.47*c.strokeWidth+m.string*c.stringSpace,a.y+0.47*c.strokeWidth+(m.fret-0.5)*c.fretSpace);
var n=h,k=m;n.beginPath();n.arc(k.x,k.y,f.radius,0,2*Math.PI,!1);n.fillStyle=f.fillColor;n.fill();n.lineWidth=f.strokeWidth;n.strokeStyle=f.strokeColor;n.stroke();0<d[g].finger&&(n=h,k=d[g].finger,n.font=f.fontWeight+" "+f.fontSize+"px "+f.fontFamily,n.textAlign="center",n.fillStyle=f.fontColor,n.fillText(k,m.x,m.y+0.3*f.fontSize))}};return h}();
ugsChordBuilder.cursorCanvas=function(){var b=ugsChordBuilder.settings.cursor,a=ugsChordBuilder.settings.dot,c={},f=null,h=null,d=!1,g=!0,l=1,s={x:0,y:0};c.init=function(a){f=a;v()};var v=function(){h=new Image;h.onload=function(){d=!0};h.src=b.imageUri};c.setCursor=function(a,b){g=a;l=b};c.draw=function(c){var n=b.radius+b.strokeWidth;f.clearRect(s.x-n,s.y-n,n+50,n+60);!d||g?(f.beginPath(),f.arc(c.x,c.y,b.radius,0,2*Math.PI,!1),f.fillStyle=b.fillColor,f.fill(),f.lineWidth=b.strokeWidth,f.strokeStyle=
b.strokeColor,f.stroke()):(f.drawImage(h,c.x,c.y),f.font=a.fontWeight+" "+a.fontSize+"px "+a.fontFamily,f.textAlign="left",f.fillStyle="black",f.fillText(l,c.x+0.8*h.width,c.y+h.height));s=c};return c}();
ugsChordBuilder.chordCanvas=function(){var b=ugsChordBuilder.entities,a=ugsChordBuilder.settings.centerAnchor,c=ugsChordBuilder.settings.anchorPos,f=ugsChordBuilder.settings.fretLabel,h=ugsChordBuilder.settings.stringLabel,d=ugsChordBuilder.settings.fretBoard,g={},l=null,s=null;g.init=function(b,c){l=b;s=c;a(s)};g.draw=function(a,m){l.clearRect(0,0,s.width,s.height);for(var g=new b.Position(c.x-0.3*f.fontSize,c.y+f.fontSize),k=1<m?f.color:f.lightColor,e=0;e<d.numFrets;e++){var p=m+e,q=g;l.font=f.fontSize+
"px "+f.fontFamily;l.textAlign="right";l.fillStyle=k;l.fillText(p,q.x,q.y);g.y+=d.fretSpace;k=f.lightColor}g=new b.Position(c.x+0.5*d.strokeWidth,c.y-0.25*f.fontSize);for(e=0;e<d.stringNames.length;e++)p=d.stringNames[e],k=g,l.font=h.fontSize+"px "+h.fontFamily,l.textAlign="center",l.fillStyle=h.color,l.fillText(p,k.x,k.y),g.x+=d.stringSpace;e=d.strokeWidth/2;p=d.numFrets*d.fretSpace;k=(d.stringNames.length-1)*d.stringSpace;l.beginPath();for(g=1;g<d.stringNames.length-1;g++)q=c.x+g*d.stringSpace+
e,l.moveTo(q,c.y+e),l.lineTo(q,c.y+p+e);for(g=1;g<d.numFrets;g++)q=c.y+g*d.fretSpace+e,l.moveTo(c.x+e,q),l.lineTo(c.x+k+e,q);l.rect(c.x+e,c.y+e,k,p);l.strokeStyle=d.strokeColor;l.lineWidth=d.strokeWidth;l.stroke();l.closePath();ugsChordBuilder.fretDots.draw(l)};return g}();
ugsChordBuilder["export"]=function(){var b=ugsChordBuilder.settings.fretBoard,a=ugsChordBuilder.settings.chord,c={},f=null,h=function(a,b){this.string=a;this.dots=b?b:[]},d=function(){var a,c=[];for(a=1;a<=b.stringNames.length;a++)c.push(new h(a));var d=ugsChordBuilder.fretDots.getDots();for(a=c.length-1;0<=a;a--)for(var e=d.length-1;0<=e;e--)c[a].string==d[e].string+1&&c[a].dots.push(d[e]);return c},g=function(a){for(var b=0,c=900,e=a.length-1;0<=e;e--)a[e].fret>b&&(b=a[e].fret),a[e].fret<c&&(c=
a[e].fret);return{max:b,min:900>c?c:b}},l=function(a){return 0<a?f+a:0},s=function(a,b){for(var c=0;c<a.length;c++)if(a[c].fret==b)return a[c].finger;return 0};c.getPrimaryFrets=function(a){f=a-1;a=d();for(var b=[],c=0;c<a.length;c++){var e=g(a[c].dots);b.push(l(e.max))}return b};c.getDefinition=function(a,b){var c=(a=v(a))&&0<a.length?a:"CHORDNAME",e="",h="",q="";f=b-1;for(var w=d(),t=0;t<w.length;t++){var A=g(w[t].dots),e=e+(l(A.max)+" "),h=h+(s(w[t].dots,A.max)+" ");A.max!=A.min&&(q+=" add: string "+
w[t].string+" fret "+l(A.min)+" finger "+s(w[t].dots,A.min))}return("{define: "+c+" frets "+e+" fingers "+h+q+"}").replace(/\s+/g," ").replace(" }","}")};c.getDefinitionHtml=function(a,b){a=v(a);var d=c.getDefinition(a,b),d=d.replace(" "+a," X07Myq791wso01"),d=d.replace(/\b(\d+)\b/g,'<span class="chordPro-X07MX001number">$1</span>'),d=d.replace(/\b(frets?|fingers?|string)\b/g,'<span class="chordPro-X07MX001attribute">$1</span>'),d=d.replace(/\b(define|add)\b/g,'<span class="chordPro-X07MX001keyword">$1</span>');
return d.replace("X07Myq791wso01",'<span class="chordPro-string">'+a+"</span>").replace(/X07MX001/g,"").replace(/ +/g," ")};var v=function(b){b=b.replace(/^\s*(.*?)\s*$/,"$1").replace(/\s+/g,"-");/^(frets|fingers|add:)$/i.test(b)&&(b="");return b.substring(0,a.nameMaxLength)};return c}();
ugsChordBuilder.chooserList=function(){var b={},a=[],c=null,f=0,h=null,d=function(){},g=null,l={showText:!1,height:50,width:40,fretSpace:9,stringSpace:7,dotRadius:3,lineWidth:1,topLeftPos:{x:10,y:2},xWidth:0.7*7,xStroke:1.4},s={dot:"8pt Arial",text:"8pt Arial",fret:"8pt Arial"},v={fretLines:"#EED18E",dots:"#551D00",dotText:"#ffffff",text:"#000000",fretText:"#EED18E",xStroke:"#551D00"},m=function(a,b){this.id=f++;this.name=a;this.definition=b};b.init=function(a){d=a;c=document.getElementById("cdBldPick");
c.addEventListener("click",k,!1);n()};var n=function(){for(var b=/\{define:\s*([^}]+?)\s+frets[^}]+?\}/im,e=document.getElementById("chordProSource").value.split("\n"),d=e.length-1;0<=d;d--)b.test(e[d])&&z(e[d].replace(b,"$1"),e[d]);for(var e=c,d=a,f="",b=0;b<d.length;b++)f+=p(d[b].id,d[b].name);e.innerHTML='<li data-id="-1" class="newChord">+ Add New Chord</li>'+f;e=e.getElementsByTagName("li");for(b=e.length-1;0<=b;b--)1>b||q(e[b].getAttribute("data-id"))};b.reset=function(){a=[];document.getElementById("cdBldPick").innerHTML=
"";f=0;h=null;n()};b.show=function(a){document.getElementById("cdBldChooserPanel").style.display=a?"block":"none";document.getElementById("cdBldBuilderPanel").style.display=a?"none":"block";$("#cdBldChooserPanel").closest(".overlay").toggleClass("chordBuilderNarrow",a)};b.save=function(d){var f;a:{f=null==h?-1:h.id;for(var g=d.name.toLowerCase(),B=a.length-1;0<=B;B--)if(""+a[B].id!=""+f&&a[B].name.toLowerCase()==g){f=B;break a}f=-1}if(0<=f)return alert("Hey, this chord name is already being used."),
!1;f=-1;if(null==h){f=z(d.name,d.definition);h=x(f);d=d.definition;for(var g=document.getElementById("chordProSource"),B=/\s*\{\s*(title|t|artist|subtitle|st|album|define):.*?\}/im,k=g.value.split("\n"),l="",m=!1,n=k.length-1;0<=n;n--)!m&&B.test(k[n])&&(l=d+"\n"+l,m=!0),l=k[n]+"\n"+l;m||(l=d+"\n"+g.value);g.value=l;ugsEditorPlus.actions.run()}else{g=A(h.id);if(0>g)return!1;B=a[g].definition;a[g].name=d.name;a[g].definition=d.definition;f=a[g].id;t(B,a[g].definition)}d=x(f);(g=e(f))?g.innerHTML=p(f,
d.name,!0):(d=d.name,g=document.createElement("ul"),g.innerHTML=p(f,d),c.appendChild(g.childNodes[0]));q(f);b.show(!0);return!0};var k=function(a){a.preventDefault();h=x(a.target.getAttribute("data-id"));if("delete"==a.target.getAttribute("data-action")){if(a=h,confirm('Delete definition for "'+a.name+'"?')){var f=e(a.id);f&&(c.removeChild(f),t(a.definition,""))}}else{a=null;if(null!=h){a=ukeGeeks.chordImport.runLine(h.definition);a:{if(a.muted)for(f=0;f<a.muted.length;f++)if(a.muted[f]){f=!0;break a}f=
!1}f&&alert("Uh-oh! This chord uses muted strings!\nCurrently the Chord Builder does not support muted strings -- \nsaving edits will result in mutes being lost.")}d(a);b.show(!1)}},e=function(a){for(var b=c.getElementsByTagName("li"),e=0;e<b.length;e++)if(b[e].getAttribute("data-id")==""+a)return b[e];return null},p=function(a,b,c){c=2<arguments.length?c:!1;var e='<span class="deleteChord" data-id="'+a+'" data-action="delete" title="Remove this definition"></span>'+b;return c?e:'<li data-id="'+a+
'" title="Edit this definition" class="ugs-grouped">'+e+"</li>"},q=function(a){var b=e(a);a=x(a);a=ukeGeeks.chordImport.runLine(a.definition);null==g&&(g=new ukeGeeks.chordBrush);g.plot(b,a,l,s,v)},w=function(a,b,c){var e=a.replace(b,c);return e==a?a:w(e,b,c)},t=function(a,b){var c=document.getElementById("chordProSource");c.value=w(c.value,a,b);ugsEditorPlus.actions.run()},A=function(b){for(var c=0;c<a.length;c++)if(""+a[c].id==b)return c;return-1},x=function(b){b=A(b);return 0<=b?a[b]:null},z=function(b,
c){var e=new m(b,c);a.push(e);return e.id};return b}();
ugsChordBuilder.editorUi=function(){var b=null,a=null,c=null,f=1,h="",d=!0,g=0,l={0:"None",1:"Index finger",2:"Middle finger",3:"Ring finger",4:"Pinkie"};this.init=function(){b=document.getElementById("cdBldCursorCanvas");if(!b.getContext)return!1;for(var e=b.getContext("2d"),d=document.getElementById("cdBldDiagramCanvas").getContext("2d"),f=document.getElementById("cdBldStartingFret"),g="",h=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1,l=1;l<=h;l++)g+=
'<option value="'+l+'">'+l+"</option>";f.innerHTML=g;f.addEventListener("change",t,!1);document.getElementById("cdBldChordName").addEventListener("keyup",w,!1);a=document.getElementById("cdBldDotsBtn");c=document.getElementById("cdBldFingersBtn");a.addEventListener("click",p,!1);c.addEventListener("click",p,!1);document.getElementById("cdBldShowOutputBtn").addEventListener("click",v,!1);document.getElementById("cdBldCancelBtn").addEventListener("click",m,!1);document.getElementById("cdBldSaveBtn").addEventListener("click",
n,!1);document.getElementById("toolboxSlideUpBtn").addEventListener("click",A,!1);document.getElementById("toolboxSlideDownBtn").addEventListener("click",A,!1);s();document.getElementById("cdBldEditorSurface").addEventListener("mousemove",x,!1);b.addEventListener("click",z,!1);ugsChordBuilder.chordCanvas.init(d,b);ugsChordBuilder.cursorCanvas.init(e);y();u();ugsChordBuilder.chooserList.init(k);return!0};var s=function(){g++;4<g&&(g=0);document.getElementById("cdBldBtnFingerName").innerHTML=l[g]+" ("+
g+")";document.getElementById("cdBldBtnDiagram").className="fingerToolImage finger"+g},v=function(a){q(document.getElementById("cdBldOutputBox"),"collapseOutput",!a.target.checked)},m=function(a){a.preventDefault();e();ugsChordBuilder.chooserList.show(!0)},n=function(a){a.preventDefault();a={name:h,startingFret:f,dots:ugsChordBuilder.fretDots.getDots(),definition:ugsChordBuilder["export"].getDefinition(h,f)};ugsChordBuilder.chooserList.save(a)||(a=document.getElementById("cdBldChordName"),a.focus(),
a.select())},k=function(a){if(null==a)e();else{var b;b=a.dots;for(var c=0,d=0;d<b.length;d++)b[d].fret>c&&(c=b[d].fret);b=c;b=b>ugsChordBuilder.settings.fretBoard.numFrets?b-ugsChordBuilder.settings.fretBoard.numFrets+1:1;c=e;d=a.name;a=a.dots;for(var f=b-1,g=[],h=0;h<a.length;h++){var k=a[h].fret-f;g.push(new ugsChordBuilder.entities.Dot(a[h].string,0>k?0:k,a[h].finger))}c(d,b,g,!1)}},e=function(b,e,k,p){p=3<arguments.length?p:!0;ugsChordBuilder.fretDots.reset();var l=p;h=b&&0<b.length?b:"CHORDNAME";
document.getElementById("cdBldChordName").value=h;f=e?e:1;document.getElementById("cdBldStartingFret").value=f;document.getElementById("cdBldShowOutputBtn").checked=!1;q(document.getElementById("cdBldOutputBox"),"collapseOutput",!0);document.getElementById("cdBldSaveBtn").value=l?"Add":"Update";d=!0;g=0;s();q(a,"selected",d);q(c,"selected",!d);q(document.getElementById("cdBldToolbox"),"open",!d);ugsChordBuilder.cursorCanvas.setCursor(d,g);if(k&&0<k.length)for(l=0;l<k.length;l++)ugsChordBuilder.fretDots.toggleDot(k[l]);
y();u()},p=function(b){b.preventDefault();b=0<=b.currentTarget.href.indexOf("#dots");b==d?b||(s(),ugsChordBuilder.cursorCanvas.setCursor(d,g)):(q(a,"selected",b),q(c,"selected",!b),q(document.getElementById("cdBldToolbox"),"open",!b),d=b,ugsChordBuilder.cursorCanvas.setCursor(d,g))},q=function(a,b,c){var e=0<=a.className.indexOf(b);c&&!e?a.className+=" "+b:!c&&e&&(a.className=a.className.replace(b,"").replace(/\s+/g," "))},w=function(a){h=this.value;u()},t=function(a){f=parseInt(this.value,10);u();
y()},A=function(a){a.preventDefault();var b=!1;a="up"==a.target.getAttribute("data-direction")?-1:1;if(ugsChordBuilder.fretDots.slide(a))b=!0;else{a=f+a;var c=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1;1<=a&&a<=c&&(f=a,document.getElementById("cdBldStartingFret").value=a,b=!0)}b&&(y(),u())},x=function(a){ugsChordBuilder.cursorCanvas.draw(r(this,a))},z=function(a){a=r(b,a);var c=ugsChordBuilder.tracking.toDot(a);c&&(d?(ugsChordBuilder.fretDots.toggleDot(c),
y(a),u()):ugsChordBuilder.fretDots.toggleFinger(c,g)&&(y(a),u()))},r=function(a,b){var c=a.getBoundingClientRect();return new ugsChordBuilder.entities.Position(b.clientX-c.left,b.clientY-c.top)},y=function(a){a=a||new ugsChordBuilder.entities.Position(0,0);ugsChordBuilder.chordCanvas.draw(a,f)},u=function(){document.getElementById("cdBldOutput").innerHTML=ugsChordBuilder["export"].getDefinitionHtml(h,f)};this.reload=function(){e();ugsChordBuilder.chooserList.reset();ugsChordBuilder.chooserList.show(!0)}};
LazyLoad=function(b){function a(a,c){var d=b.createElement(a),f;for(f in c)c.hasOwnProperty(f)&&d.setAttribute(f,c[f]);return d}function c(a){var b=v[a],c,d;b&&(c=b.callback,d=b.urls,d.shift(),m=0,d.length||(c&&c.call(b.context,b.obj),v[a]=null,n[a].length&&h(a)))}function f(){var a=navigator.userAgent;l={async:!0===b.createElement("script").async};(l.webkit=/AppleWebKit\//.test(a))||(l.ie=/MSIE|Trident/.test(a))||(l.opera=/Opera/.test(a))||(l.gecko=/Gecko\//.test(a))||(l.unknown=!0)}function h(e,
h,k,m,t){var A=function(){c(e)},x="css"===e,z=[],r,y,u,B;l||f();if(h)if(h="string"===typeof h?[h]:h.concat(),x||l.async||l.gecko||l.opera)n[e].push({urls:h,callback:k,obj:m,context:t});else for(r=0,y=h.length;r<y;++r)n[e].push({urls:[h[r]],callback:r===y-1?k:null,obj:m,context:t});if(!v[e]&&(B=v[e]=n[e].shift())){s||(s=b.head||b.getElementsByTagName("head")[0]);h=B.urls.concat();r=0;for(y=h.length;r<y;++r)k=h[r],x?u=l.gecko?a("style"):a("link",{href:k,rel:"stylesheet"}):(u=a("script",{src:k}),u.async=
!1),u.className="lazyload",u.setAttribute("charset","utf-8"),l.ie&&!x&&"onreadystatechange"in u&&!("draggable"in u)?u.onreadystatechange=function(){/loaded|complete/.test(u.readyState)&&(u.onreadystatechange=null,A())}:x&&(l.gecko||l.webkit)?l.webkit?(B.urls[r]=u.href,g()):(u.innerHTML='@import "'+k+'";',d(u)):u.onload=u.onerror=A,z.push(u);r=0;for(y=z.length;r<y;++r)s.appendChild(z[r])}}function d(a){var b;try{b=!!a.sheet.cssRules}catch(f){m+=1;200>m?setTimeout(function(){d(a)},50):b&&c("css");return}c("css")}
function g(){var a=v.css,b;if(a){for(b=k.length;0<=--b;)if(k[b].href===a.urls[0]){c("css");break}m+=1;a&&(200>m?setTimeout(g,50):c("css"))}}var l,s,v={},m=0,n={css:[],js:[]},k=b.styleSheets;return{css:function(a,b,c,d){h("css",a,b,c,d)},js:function(a,b,c,d){h("js",a,b,c,d)}}}(this.document);